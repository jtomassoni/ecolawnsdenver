{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/jamestomassoni/ecolawnsdenver/app/api/send-email/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport nodemailer from 'nodemailer';\n\n// Create nodemailer transporter\nconst transporter = nodemailer.createTransport({\n  service: 'gmail',\n  auth: {\n    user: process.env.EMAIL_USER,\n    pass: process.env.EMAIL_APP_PASSWORD,\n  },\n});\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { name, email, phone, address, lawnSize, subscriptionOption, frequency, type, drivewayLength, notes } = body;\n\n    // Validate required fields\n    if (!email) {\n      return NextResponse.json(\n        { success: false, message: 'Email is required' },\n        { status: 400 }\n      );\n    }\n\n    // Sanitize and validate inputs\n    const sanitizeString = (str: string | undefined, maxLength = 500): string => {\n      if (!str) return '';\n      return String(str).trim().slice(0, maxLength).replace(/[<>]/g, '');\n    };\n\n    const sanitizedName = sanitizeString(name, 100);\n    const sanitizedEmail = sanitizeString(email, 100).toLowerCase();\n    const sanitizedPhone = sanitizeString(phone, 20).replace(/\\D/g, '');\n    const sanitizedAddress = sanitizeString(address, 200);\n    const sanitizedLawnSize = sanitizeString(lawnSize, 10).replace(/\\D/g, '');\n    const sanitizedType = sanitizeString(type, 50);\n    const sanitizedDrivewayLength = sanitizeString(drivewayLength, 10);\n    const sanitizedNotes = sanitizeString(notes, 500);\n\n    // Validate email format\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(sanitizedEmail)) {\n      return NextResponse.json(\n        { success: false, message: 'Invalid email format' },\n        { status: 400 }\n      );\n    }\n\n    // Validate phone (at least 10 digits)\n    if (sanitizedPhone.length < 10) {\n      return NextResponse.json(\n        { success: false, message: 'Invalid phone number format' },\n        { status: 400 }\n      );\n    }\n\n    // Check if email configuration is set up\n    if (!process.env.EMAIL_USER || !process.env.EMAIL_APP_PASSWORD) {\n      return NextResponse.json(\n        { success: false, message: 'Email service not configured properly' },\n        { status: 500 }\n      );\n    }\n\n    const mailOptions = {\n      from: process.env.EMAIL_USER,\n      to: process.env.EMAIL_USER,\n      subject: `New ${sanitizedType || 'Lawn Service Booking'} from ${sanitizedName || 'No Name'}`,\n      html: `\n        <h2>New ${sanitizedType || 'Lawn Service Booking'} Submission</h2>\n        <p><strong>Name:</strong> ${sanitizedName || 'Not provided'}</p>\n        <p><strong>Email:</strong> ${sanitizedEmail}</p>\n        <p><strong>Phone:</strong> ${sanitizedPhone || 'Not provided'}</p>\n        <p><strong>Property Address:</strong> ${sanitizedAddress || 'Not provided'}</p>\n        ${sanitizedLawnSize ? `<p><strong>Lawn Size:</strong> ${sanitizedLawnSize} sq ft</p>` : ''}\n        ${subscriptionOption ? `<p><strong>Package:</strong> ${subscriptionOption === 'seasonPass' ? 'Season Pass' : subscriptionOption === 'biweekly' ? 'Bi-Weekly' : subscriptionOption}</p>` : ''}\n        ${frequency ? `<p><strong>Frequency:</strong> ${frequency === 'weekly' ? 'Weekly' : 'Bi-Weekly'}</p>` : ''}\n        ${sanitizedDrivewayLength ? `<p><strong>Driveway Length:</strong> ${sanitizedDrivewayLength} feet</p>` : ''}\n        ${sanitizedNotes ? `<p><strong>Notes:</strong> ${sanitizedNotes}</p>` : ''}\n      `,\n    };\n\n    await transporter.sendMail(mailOptions);\n\n    return NextResponse.json({ success: true, message: 'Email sent successfully' });\n  } catch (error: any) {\n    console.error('Error sending email:', error);\n    \n    let errorMessage = 'Failed to send email. Please try again later.';\n    if (error.code === 'EAUTH' || error.message?.includes('Invalid login')) {\n      errorMessage = 'Email service authentication failed. Please check email configuration.';\n    } else if (error.code === 'ECONNECTION' || error.message?.includes('connect')) {\n      errorMessage = 'Could not connect to email service. Please check your internet connection.';\n    }\n\n    return NextResponse.json(\n      { success: false, message: errorMessage },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}